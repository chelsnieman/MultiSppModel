---
title: 'Q2: Hysteresis and Management'
author: "Colin Dassow and Chelsey Nieman"
date: "7/8/2020"
output: 
   word_document:
      reference_docx: reference_format.docx
bibliography: MultispeciesModelCite.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages <- c("citr","bibtex","tidyverse","knitr","tinytex")

#some other packages and code to be used throughout the document
# Colin setting his working directory setwd("C:/Users/jones/BoxSync/NDstuff/Dissertation/4/MultiSppModel")
library(deSolve)
library(ggpubr)
source("q2Func.R")
```

# Abstract

# Introduction
      
The relationship between hysteresis and fisheries  

Ecosystem-based management  
   What Ecosystem-based management/adpative management is.  
Shown to increase system resilience  
      ecosystem-based management has been shown to increase resilience of systems [@hansen2015]. 
      May be useful in systems where linear management is not effective [@pine2009].  

Where the literature is at with hysteresis and management:   
      Commercial fisheries   
      -hysteresis and regime shift are important considerations in adaptive management in these systems [@steele1996],[@rothschild2004].  
      - Ecosystem-based management plays an important role in maintaining desired stable-state [@levin2015].  
      - Efforts to model this in multiple marine fishes [@crowder2008]  
      - Management has been shown to manage desired stable states of coral reef areas [@blackwood2012]  
      This model is unique in that it looks at hysteresis and management in (1) a freshwater system, and (2) a multispecies system in which both species are game fish.  
This model   
The goal of this study is:  
     (1) to understand the role hysteresis plays in both the type and magnitude of management responses necessary to maintain a system in a desired configuration.   
     (2) to investigate the role management responses can play in reverting to an alternative configuration.   
We do this by:   
      Modeling species-specific responses to regulations and stocking  
      Consideration of optimal strategy and magnitude to maintain system in a desire state  
      With and without hysteresis   
      Consideration of optimal strategy and magnitude to change system state.   
      Also with and without hysteresis  

# Methods
## The Model 
Base model  
Stocking   
Management (species specific)   
How we got hysteresis in the system    

## Simulation Space  
Optimal management scenarios   

```{r, cash.comments=FALSE}
#not sure exactly where we want this, in the simulation space or right in the results

#these get reused for both plots below
h1Fun=approxfun(x=tstep,y=rep(8,length(tstep)))
h2Fun=approxfun(x=tstep,y=rep(8,length(tstep)))

#### OUTCOMES WITH HYSTERESIS ####
qEs=seq(0,8,length.out = 15)
sto=seq(0,200, length.out = 15)
df=expand.grid(X=qEs,Y=sto)
df$A1=numeric(nrow(df))
df$A2=numeric(nrow(df))
df$J1=numeric(nrow(df))
df$J2=numeric(nrow(df))

for(i in 1:nrow(df)){
  tstep=1:300
  qE1Fun=approxfun(x=tstep,y=rep(df$X[i], length(tstep)))
  qE2Fun=approxfun(x=tstep,y=rep(0, length(tstep)))
  st1Fun=approxfun(x=tstep,y=rep(df$Y[i],length(tstep)))
  st2Fun=approxfun(x=tstep,y=rep(0,length(tstep)))
  p=c(s1=0.1,cJ1A1=0.002,cJ1A2=0.5,cJ1J2=0.003,v1=1,f1=2,
      s2=0.1,cJ2A2=0.002,cJ2A1=0.003,cJ2J1=0.003,v2=1,f2=3)
  y0=c(10,10,0,0)
  sim=ode(y=y0,times=tstep,func=simBiggsQ2,parms=p)
  df$A1[i]=sim[nrow(sim)-1,2]
  df$A2[i]=sim[nrow(sim)-1,3]
  df$J1[i]=sim[nrow(sim)-1,4]
  df$J2[i]=sim[nrow(sim)-1,5]
}

vz=ggplot(data = df)+theme_classic()
a=vz+geom_tile(aes(x=df$X, y=df$Y, fill=df$A1))+scale_fill_gradient(low ="blue", high = "yellow", name="")+
  labs(x="Harvest Rate", y="Stocked Fish per Year", title = "Hysteresis Present")+
   guides(fill="none")

#### OUTCOMES WITHOUT HYSTERESIS ####
qEs=seq(0,8,length.out = 15)
sto=seq(0,200, length.out = 15)
dfwo=expand.grid(X=qEs,Y=sto)
dfwo$A1=numeric(nrow(dfwo))
dfwo$A2=numeric(nrow(dfwo))
dfwo$J1=numeric(nrow(dfwo))
dfwo$J2=numeric(nrow(dfwo))

for(i in 1:nrow(dfwo)){
  tstep=1:300
  qE1Fun=approxfun(x=tstep,y=rep(dfwo$X[i], length(tstep)))
  qE2Fun=approxfun(x=tstep,y=rep(0, length(tstep)))
  st1Fun=approxfun(x=tstep,y=rep(dfwo$Y[i],length(tstep)))
  st2Fun=approxfun(x=tstep,y=rep(0,length(tstep)))
  p=c(s1=0.1,cJ1A1=0.002,cJ1A2=0,cJ1J2=0,v1=1,f1=2,
      s2=0.1,cJ2A2=0.002,cJ2A1=0,cJ2J1=0,v2=1,f2=2)
  y0=c(10,10,0,0)
  sim=ode(y=y0,times=tstep,func=simBiggsQ2,parms=p)
  dfwo$A1[i]=sim[nrow(sim)-1,2]
  dfwo$A2[i]=sim[nrow(sim)-1,3]
  dfwo$J1[i]=sim[nrow(sim)-1,4]
  dfwo$J2[i]=sim[nrow(sim)-1,5]
}

vzwo=ggplot(data = dfwo)+theme_classic()
b=vzwo+geom_tile(aes(x=dfwo$X, y=dfwo$Y, fill=dfwo$A1))+
  scale_fill_gradient(low ="blue", high = "yellow", name="A1 Abund")+
  labs(x="Harvest Rate", y="", title = "No Hysteresis Present")

#comparing with and without hysteresis plots together 
ggarrange(a,b,labels = c("A","B"), nrow = 1,ncol = 2)
#this plot is a start at least, the point here is that when the species interact (hysteresis present) low levels of stocking at any harvest rate aren't enough to keep the system in a state where A1 dominates. (right now I'm using A1 abundance at my way of telling who dominates but it's not quite right I don't think. It'd be easy enough to pull different info out of the model runs if we wanted.)
```
# Results
Responses to regulations and stocking (maintain system state)  
   - optimal strategy and magnitude  
   - influence of hysteresis  
   
Responses to regulations and stocking (maintain system state)  
   - optimal strategy and magnitude  
   - influence of hysteresis   
   
# Discussion

# References

